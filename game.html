<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <script src="jquery-1.10.1.min.js" type="text/javascript"></script>
<!--    <script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>-->
    <title>Simple Game</title>
    <style>
        body {
            margin:0;
            padding:0;
            text-align:center;
        }
        canvas {
            outline:0;
            border:1px solid #000;
            margin-left:auto;
            margin-right:auto;
        }
    </style>
</head>
<body>
    <canvas id="myCanvas" width="1000" height="600"></canvas>
    
    <script>
        var context;
        var sizeX = 1000;
        var sizeY = 600;
        
        var game = new Game(sizeX, sizeY);
                
        $(document).ready(function () {           
            document.body.onkeydown = function (evt) {
                evt = evt ?
                      evt :
                      window.event;

                if (evt.keyCode == 40) game.downKeyPressed = true;
                if (evt.keyCode == 38) game.upKeyPressed = true;
                if (evt.keyCode == 37) game.leftKeyPressed = true;
                if (evt.keyCode == 39) game.rightKeyPressed = true;
                if (evt.keyCode == 32) game.spaceKeyPressed = true;

                console.log(evt);
            };

            document.body.onkeyup = function (evt) {
                evt = evt ?
                    evt :
                      window.event;

                if (evt.keyCode == 40) game.downKeyPressed = false;
                if (evt.keyCode == 38) game.upKeyPressed = false;
                if (evt.keyCode == 37) game.leftKeyPressed = false;
                if (evt.keyCode == 39) game.rightKeyPressed = false;
                if (evt.keyCode == 32) game.spaceKeyPressed = false;
            };

            context = myCanvas.getContext('2d');
            setInterval(renderGame, 33);

        });

        function renderGame() {
            game.update();
            game.draw(context);           
        }

        function getRandomColor() {
            var letters = '0123456789ABCDEF'.split('');
            var color = '#';
            for (var i = 0; i < 6; i++) {
                color += letters[Math.round(Math.random() * 15)];
            }

            return color;
        }        

        function Hero(x, y, color, dx, dy, radius, width, height) {
            this.x = x;
            this.y = y;
            this.color = color;
            this.dx = dx;
            this.dy = dy;
            this.radius = radius;
            this.width = width;
            this.height = height;
            this.weapon = new Weapon(width, height);

            this.draw = function (context) {
                context.beginPath();
                context.fillStyle = this.color;
                context.arc(this.x, this.y, this.radius, 0, Math.PI * 2, true);
                context.closePath();
                context.fill();

                this.weapon.draw(context);
            }

            this.update = function () {
                this.x += this.dx;
                this.y += this.dy;

                this.weapon.update();
            }
        }

        function Bullet(x, y, color, dx, dy, width, height) {
            this.x = x;
            this.y = y;
            this.color = color;
            this.dx = dx;
            this.dy = dy;
            this.height = height;
            this.width = width;

            this.draw = function (context) {
                context.beginPath();
                context.fillStyle = this.color;
                context.rect(this.x, this.y, this.width, this.height);
                context.closePath();
                context.fill();
            }

            this.update = function () {
                this.x += this.dx;
                this.y += this.dy;
            }
        }

        function Enemy(x, y, color, dx, dy, width, height) {
            this.x = x;
            this.y = y;
            this.color = color;
            this.dx = dx;
            this.dy = dy;
            this.height = height;
            this.width = width;

            this.draw = function (context) {
                context.beginPath();
                context.fillStyle = this.color;
                context.rect(this.x, this.y, this.width, this.height);
                context.closePath();
                context.fill();
            }

            this.update = function () {
                this.x += this.dx;
                this.y += this.dy;
            }
        }

        function Weapon(width,height) {
            this.bullets = [];
            this.width = width;
            this.height = height;

            this.draw = function (context) {
                for (var index in this.bullets) {
                    this.bullets[index].draw(context);
                }
            }

            this.update = function () {
                for (var i = this.bullets.length - 1; i >= 0; i--) {
                    if (this.bullets[i].y + 30 < 0 || this.bullets[i].y - 30 > this.height)
                        this.bullets.splice(i, 1);
                }

                for (var index in this.bullets) {
                    this.bullets[index].update();
                }
            }
        }

        function Game(width, height) {
            this.enemies = [];
            this.width = width;
            this.height = height;

            this.downKeyPressed = false;
            this.upKeyPressed = false;
            this.leftKeyPressed = false;
            this.rightKeyPressed = false;
            this.spaceKeyPressed = false;

            this.enemies.push(new Enemy(Math.random() * sizeX,
                                        Math.random() * sizeY / 2,
                                        getRandomColor(),
                                        3,
                                        0,
                                        200,
                                        100),
                              new Enemy(Math.random() * sizeX,
                                        Math.random() * sizeY / 2,
                                        getRandomColor(),
                                        3,
                                        0,
                                        100,
                                        50));

            this.hero = new Hero(sizeX / 2,
                                     sizeY / 2 + 200,
                                     getRandomColor(),
                                     0,
                                     0,
                                     (Math.random() + 0.5) * 30);

            this.draw = function (context) {
                context.clearRect(0, 0, this.width, this.height); 

                this.hero.draw(context);

                for (var i = 0; i < this.enemies.length; i++) {
                    this.enemies[i].draw(context);
                }
            }

            this.update = function () {

                if (this.hero.x < 0 || this.hero.x > this.width) this.hero.dx = -this.hero.dx;
                if (this.hero.y < 0 || this.hero.y > this.height) this.hero.dy = -this.hero.dy;

                if (this.downKeyPressed) this.hero.dy += 0.5;
                if (this.upKeyPressed) this.hero.dy -= 0.5;
                if (this.leftKeyPressed) this.hero.dx -= 0.5;
                if (this.rightKeyPressed) this.hero.dx += 0.5;

                this.hero.update();

                if (this.spaceKeyPressed) {
                    this.hero.weapon.bullets.push(new Bullet(this.hero.x,
                                                       this.hero.y,
                                                       getRandomColor(),
                                                       0,
                                                       -2,
                                                       20,
                                                       40));
                }

                for (var i = this.hero.weapon.bullets.length - 1; i >= 0; i--) {
                    for (var j = this.enemies.length - 1; j >= 0; j--) {
                        if (this.enemies[j].y + this.enemies[j].height >= this.hero.weapon.bullets[i].y
                            && this.hero.weapon.bullets[i].y + this.hero.weapon.bullets[i].height >= this.enemies[j].y
                            && this.enemies[j].x <= this.hero.weapon.bullets[i].x + this.hero.weapon.bullets[i].width
                            && this.hero.weapon.bullets[i].x <= this.enemies[j].x + this.enemies[j].width) {
                            this.enemies.splice(j, 1);
                            this.hero.weapon.bullets.splice(i, 1);
                        }
                    }
                }

                for (var i = 0; i < this.enemies.length; i++) {
                    if (this.enemies[i].x < 0 || this.enemies[i].x > this.width) this.enemies[i].dx = -this.enemies[i].dx;
                    if (this.enemies[i].y < this.width / 2 || this.enemies[i].y > this.height) this.enemies[i].dy = -this.enemies[i].dy;

                    this.enemies[i].update();
                }
            }
        }
    </script>
</body>
</html> 