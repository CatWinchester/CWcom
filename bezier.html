<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <link rel="stylesheet" type="text/css" href="css/grid.css" />
    <script src="http://code.jquery.com/jquery-2.0.3.js"></script>
    <script src="http://knockoutjs.com/downloads/knockout-2.3.0.js" ></script>
    <title>Bezier</title>
    <style>
        #myScreen {
            border:2px solid #ff0000;
            display:block;
            margin:0 auto;
        }
    </style>
</head>
<body>
    <div class="section group">
        <div class="col span_4_of_4" >
            <canvas id="myScreen" width="1000" height="500"></canvas>
        </div>
    </div>


    <script>
        var canvas = document.getElementById('myScreen');
        var ctx = canvas.getContext('2d');
        var interval = 20; //как часто обновлять экран(милисекунды)

        var isDrag = false;
        var mx, my; //координаты мышки

        var bezierVertexes = [];
        var linesBetweenVertexes = [];

        function getRandomColor() {
            var letters = '0123456789ABCDEF'.split('');
            var color = '#';
            for (var i = 0; i < 6; i++) {
                color += letters[Math.round(Math.random() * 15)];
            }
            return color;
        }

        function BezierVertex(x, y, width, height, fillColor) {
            this.x = x;
            this.y = y;
            this.width = width;
            this.height = height;
            this.fillColor = fillColor;

            this.draw = function (context) {
                context.beginPath();
                context.fillStyle = this.fillColor;
                context.rect(this.x, this.y, this.width, this.height);
                context.closePath();
                context.fill();
            }
        }

        function LineBetweenVertexes(x, y, xTo, yTo, color) {
            this.x = x;
            this.y = y;
            this.xTo = xTo;
            this.yTo = yTo;
            this.color = color;

            this.draw = function (context) {
                context.beginPath();
                context.moveTo(this.x, this.y);
                context.lineTo(this.xTo, this.yTo);
                context.strokeStyle = color;
                context.stroke();
                context.closePath();
            }
        }

        //опорные точки
        var vertexX0 = 80,  vertexY0 = 130, //P0
            vertexX1 = 150, vertexY1 = 30, //P1
            vertexX2 = 260, vertexY2 = 120,  //P2
            vertexX3 = 320, vertexY3 = 100, //P3
            vertexX4 = 380, vertexY4 = 60;  //P4
            vertexX5 = 480, vertexY5 = 160;  //P5

        bezierVertexes.push(new BezierVertex(vertexX0, vertexY0, 10, 10, getRandomColor()),
                            new BezierVertex(vertexX1, vertexY1, 10, 10, getRandomColor()),
                            new BezierVertex(vertexX2, vertexY2, 10, 10, getRandomColor()),
                            new BezierVertex(vertexX3, vertexY3, 10, 10, getRandomColor()),
                            new BezierVertex(vertexX4, vertexY4, 10, 10, getRandomColor()),
                            new BezierVertex(vertexX5, vertexY5, 10, 10, getRandomColor()));

        linesBetweenVertexes.push(new LineBetweenVertexes(vertexX0, vertexY0, vertexX1, vertexY1, getRandomColor()),
                                  new LineBetweenVertexes(vertexX1, vertexY1, vertexX2, vertexY2, getRandomColor()),
                                  new LineBetweenVertexes(vertexX2, vertexY2, vertexX3, vertexY3, getRandomColor()),
                                  new LineBetweenVertexes(vertexX3, vertexY3, vertexX4, vertexY4, getRandomColor()),
                                  new LineBetweenVertexes(vertexX4, vertexY4, vertexX5, vertexY5, getRandomColor()));

        for (var i = 0; i < bezierVertexes.length; i++) {
            bezierVertexes[i].draw(ctx);
        }

        for (var i = 0; i < linesBetweenVertexes.length; i++) {
            linesBetweenVertexes[i].draw(ctx);
        }
         
        //считаем х и у
        function bezier_x(t) {
            return Math.pow(1 - t, 5) * vertexX0 +
                   5 * t * Math.pow(1 - t, 4) * vertexX1 +
                   10 * t * t * Math.pow(1 - t, 3) * vertexX2 +
                   10 * t * t * Math.pow(1 - t, 2) * vertexX3 +
                   5* Math.pow(t, 4) * (1 - t) * vertexX4 +
                   Math.pow(t, 5) * vertexX5;
        }

        function bezier_y(t) {
            return Math.pow(1 - t, 5) * vertexY0 +
                   5 * t * Math.pow(1 - t, 4) * vertexY1 +
                   10 * t * t * Math.pow(1 - t, 3) * vertexY2 +
                   10 * t * t * Math.pow(1 - t, 2) * vertexY3 +
                   5 * Math.pow(t, 4) * (1 - t) * vertexY4 +
                   Math.pow(t, 5) * vertexY5;
        }

        function BezierSpline(context) {
            context.beginPath();
            context.moveTo(vertexX0, vertexY0);
            for (i = 0; i <= 1; i += 0.01) {
                ctx.lineTo(bezier_x(i), bezier_y(i));
                ctx.stroke();
            }
            context.closePath();
        }

        BezierSpline(ctx);

    </script>
</body>
</html>